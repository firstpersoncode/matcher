import Animated, {
  useAnimatedScrollHandler,
  useSharedValue,
} from 'react-native-reanimated';

export default function AnimatedScrollView({
  children,
  style,
  onScrollDown,
  onScrollUp,
  refreshControl,
}) {
  const lastContentOffset = useSharedValue(0);
  const isScrolling = useSharedValue(false);

  const scrollHandler = useAnimatedScrollHandler({
    onScroll: event => {
      if (
        lastContentOffset.value > event.contentOffset.y &&
        isScrolling.value
      ) {
        onScrollUp();
      } else if (
        lastContentOffset.value < event.contentOffset.y &&
        isScrolling.value
      ) {
        onScrollDown();
      }
      lastContentOffset.value = event.contentOffset.y;
    },
    onBeginDrag: e => {
      isScrolling.value = true;
    },
    onEndDrag: e => {
      isScrolling.value = false;
    },
  });

  return (
    <Animated.ScrollView
      style={{flex: 1, ...style}}
      scrollEventThrottle={16}
      onScroll={scrollHandler}
      refreshControl={refreshControl}>
      {children}
    </Animated.ScrollView>
  );
}
